<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-2"></span><span class="hs-comment">--</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- Module      :  $Headers</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- Copyright   :  (c) 2021 Brian W Bush</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- License     :  MIT</span><span>
</span><span id="line-6"></span><span class="hs-comment">--</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- Maintainer  :  Brian W Bush &lt;code@functionally.io&gt;</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Stability   :  Experimental</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- Portability :  Portable</span><span>
</span><span id="line-10"></span><span class="hs-comment">--</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- | Handling transactions.</span><span>
</span><span id="line-12"></span><span class="hs-comment">--</span><span>
</span><span id="line-13"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts  #-}</span><span>
</span><span id="line-17"></span><span class="hs-pragma">{-# LANGUAGE GADTs             #-}</span><span>
</span><span id="line-18"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-19"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards   #-}</span><span>
</span><span id="line-20"></span><span class="hs-pragma">{-# LANGUAGE TupleSections     #-}</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Mantra.Transaction</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-24"></span><span class="annot"><span class="hs-comment">-- * Transactions</span></span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><a href="Mantra.Transaction.html#makeTransaction"><span class="hs-identifier">makeTransaction</span></a></span><span>
</span><span id="line-26"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Mantra.Transaction.html#includeFee"><span class="hs-identifier">includeFee</span></a></span><span>
</span><span id="line-27"></span><span class="annot"><span class="hs-comment">-- * Metadata</span></span><span>
</span><span id="line-28"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Mantra.Transaction.html#readMetadata"><span class="hs-identifier">readMetadata</span></a></span><span>
</span><span id="line-29"></span><span class="annot"><span class="hs-comment">-- * Printing</span></span><span>
</span><span id="line-30"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Mantra.Transaction.html#printUTxO"><span class="hs-identifier">printUTxO</span></a></span><span>
</span><span id="line-31"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Mantra.Transaction.html#printValue"><span class="hs-identifier">printValue</span></a></span><span>
</span><span id="line-32"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Mantra.Transaction.html#printValueIO"><span class="hs-identifier">printValueIO</span></a></span><span>
</span><span id="line-33"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Mantra.Transaction.html#summarizeValues"><span class="hs-identifier">summarizeValues</span></a></span><span>
</span><span id="line-34"></span><span class="annot"><span class="hs-comment">-- * Minting</span></span><span>
</span><span id="line-35"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Mantra.Transaction.html#makeMinting"><span class="hs-identifier">makeMinting</span></a></span><span>
</span><span id="line-36"></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Mantra.Transaction.html#readMinting"><span class="hs-identifier">readMinting</span></a></span><span>
</span><span id="line-37"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Api</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">AssetId</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">AssetName</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">BuildTx</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">BuildTxWith</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Hash</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">IsCardanoEra</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">IsShelleyBasedEra</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">KeyWitnessInCtx</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Lovelace</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">NetworkId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">PaymentKey</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">PolicyId</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Quantity</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ScriptLanguage</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">SimpleScript</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">SimpleScriptV2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">SimpleScriptVersion</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ScriptWitness</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">SlotNo</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxAuxScripts</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxCertificates</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxExtraScriptData</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxExtraKeyWitnesses</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxFee</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxInsCollateral</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxMetadata</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxMetadataInEra</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxMetadataJsonSchema</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxMintValue</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxOutDatumHash</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxScriptValidity</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxUpdateProposal</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxValidityLowerBound</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxValidityUpperBound</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxWithdrawals</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Value</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Witness</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">estimateTransactionFee</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">filterValue</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">lovelaceToValue</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">makeSignedTransaction</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">makeTransactionBody</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">metadataFromJson</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">multiAssetSupportedInEra</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">negateValue</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">scriptLanguageSupportedInEra</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">selectLovelace</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">serialiseToRawBytesHex</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">txFeesExplicitInEra</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">txMetadataSupportedInEra</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">validityNoUpperBoundSupportedInEra</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">validityUpperBoundSupportedInEra</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">valueFromList</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">valueToList</span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Api.Shelley</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ProtocolParameters</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxBodyContent</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxId</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxIn</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxOut</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxOutValue</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">UTxO</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">protocolParamTxFeeFixed</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">protocolParamTxFeePerByte</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadIO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">liftIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Mantra.Script.html"><span class="hs-identifier">Mantra.Script</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mantra.Script.html#mintingScript"><span class="hs-identifier">mintingScript</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Mantra.Types.html"><span class="hs-identifier">Mantra.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mantra.Types.html#MantraM"><span class="hs-identifier">MantraM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Mantra.Types.html#foistMantraEither"><span class="hs-identifier">foistMantraEither</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Mantra.Types.html#foistMantraMaybeIO"><span class="hs-identifier">foistMantraMaybeIO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span>            </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Value</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">decodeFileStrict</span></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">pack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unpack</span></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span>   </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">H</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">keys</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">singleton</span></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span>       </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">assocs</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">singleton</span></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span>             </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">pack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unpack</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-comment">-- | Make a valid fee.</span><span>
</span><span id="line-54"></span><span id="local-6989586621679142471"><span class="annot"><a href="Mantra.Transaction.html#validFee"><span class="hs-identifier hs-type">validFee</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IsCardanoEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679142471"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-55"></span><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lovelace</span></span><span>  </span><span class="hs-comment">-- ^ The amount of lovelace.</span><span>
</span><span id="line-56"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxFee</span></span><span> </span><span class="annot"><a href="#local-6989586621679142471"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-comment">-- ^ The fee for the era.</span></span><span>
</span><span id="line-57"></span><span id="validFee"><span class="annot"><span class="annottext">validFee :: Lovelace -&gt; TxFee era
</span><a href="Mantra.Transaction.html#validFee"><span class="hs-identifier hs-var hs-var">validFee</span></a></span></span><span> </span><span id="local-6989586621679142305"><span class="annot"><span class="annottext">Lovelace
</span><a href="#local-6989586621679142305"><span class="hs-identifier hs-var">fee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-58"></span><span>  </span><span class="annot"><span class="annottext">(TxFeesImplicitInEra era -&gt; TxFee era)
-&gt; (TxFeesExplicitInEra era -&gt; TxFee era)
-&gt; Either (TxFeesImplicitInEra era) (TxFeesExplicitInEra era)
-&gt; TxFee era
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span>
</span><span id="line-59"></span><span>    </span><span class="annot"><span class="annottext">TxFeesImplicitInEra era -&gt; TxFee era
forall era. TxFeesImplicitInEra era -&gt; TxFee era
</span><span class="hs-identifier hs-var">TxFeeImplicit</span></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxFeesExplicitInEra era -&gt; Lovelace -&gt; TxFee era
forall era. TxFeesExplicitInEra era -&gt; Lovelace -&gt; TxFee era
</span><span class="hs-operator hs-var">`TxFeeExplicit`</span></span><span> </span><span class="annot"><span class="annottext">Lovelace
</span><a href="#local-6989586621679142305"><span class="hs-identifier hs-var">fee</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>    </span><span class="annot"><span class="annottext">(Either (TxFeesImplicitInEra era) (TxFeesExplicitInEra era)
 -&gt; TxFee era)
-&gt; Either (TxFeesImplicitInEra era) (TxFeesExplicitInEra era)
-&gt; TxFee era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CardanoEra era
-&gt; Either (TxFeesImplicitInEra era) (TxFeesExplicitInEra era)
forall era.
CardanoEra era
-&gt; Either (TxFeesImplicitInEra era) (TxFeesExplicitInEra era)
</span><span class="hs-identifier hs-var">txFeesExplicitInEra</span></span><span> </span><span class="annot"><span class="annottext">CardanoEra era
forall era. IsCardanoEra era =&gt; CardanoEra era
</span><span class="hs-identifier hs-var">cardanoEra</span></span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-comment">-- | Make a valid range of slots.</span><span>
</span><span id="line-65"></span><span id="local-6989586621679142470"><span class="annot"><a href="Mantra.Transaction.html#validRange"><span class="hs-identifier hs-type">validRange</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IsCardanoEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679142470"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-66"></span><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span>                                         </span><span class="hs-comment">-- ^ The upper bound, if any.</span><span>
</span><span id="line-67"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxValidityLowerBound</span></span><span> </span><span class="annot"><a href="#local-6989586621679142470"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxValidityUpperBound</span></span><span> </span><span class="annot"><a href="#local-6989586621679142470"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ The range for the era.</span></span><span>
</span><span id="line-68"></span><span id="validRange"><span class="annot"><span class="annottext">validRange :: Maybe SlotNo
-&gt; (TxValidityLowerBound era, TxValidityUpperBound era)
</span><a href="Mantra.Transaction.html#validRange"><span class="hs-identifier hs-var hs-var">validRange</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe SlotNo
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679142299"><span class="annot"><span class="annottext">ValidityNoUpperBoundSupportedInEra era
</span><a href="#local-6989586621679142299"><span class="hs-identifier hs-var">supported</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CardanoEra era -&gt; Maybe (ValidityNoUpperBoundSupportedInEra era)
forall era.
CardanoEra era -&gt; Maybe (ValidityNoUpperBoundSupportedInEra era)
</span><span class="hs-identifier hs-var">validityNoUpperBoundSupportedInEra</span></span><span> </span><span class="annot"><span class="annottext">CardanoEra era
forall era. IsCardanoEra era =&gt; CardanoEra era
</span><span class="hs-identifier hs-var">cardanoEra</span></span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-keyword">in</span><span>
</span><span id="line-72"></span><span>    </span><span class="hs-special">(</span><span>
</span><span id="line-73"></span><span>      </span><span class="annot"><span class="annottext">TxValidityLowerBound era
forall era. TxValidityLowerBound era
</span><span class="hs-identifier hs-var">TxValidityNoLowerBound</span></span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ValidityNoUpperBoundSupportedInEra era -&gt; TxValidityUpperBound era
forall era.
ValidityNoUpperBoundSupportedInEra era -&gt; TxValidityUpperBound era
</span><span class="hs-identifier hs-var">TxValidityNoUpperBound</span></span><span> </span><span class="annot"><span class="annottext">ValidityNoUpperBoundSupportedInEra era
</span><a href="#local-6989586621679142299"><span class="hs-identifier hs-var">supported</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="annot"><a href="Mantra.Transaction.html#validRange"><span class="hs-identifier hs-var">validRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679142296"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679142296"><span class="hs-identifier hs-var">before</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679142295"><span class="annot"><span class="annottext">ValidityNoUpperBoundSupportedInEra era
</span><a href="#local-6989586621679142295"><span class="hs-identifier hs-var">notSupported</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CardanoEra era -&gt; Maybe (ValidityNoUpperBoundSupportedInEra era)
forall era.
CardanoEra era -&gt; Maybe (ValidityNoUpperBoundSupportedInEra era)
</span><span class="hs-identifier hs-var">validityNoUpperBoundSupportedInEra</span></span><span> </span><span class="annot"><span class="annottext">CardanoEra era
forall era. IsCardanoEra era =&gt; CardanoEra era
</span><span class="hs-identifier hs-var">cardanoEra</span></span><span>
</span><span id="line-79"></span><span>    </span><span id="local-6989586621679142294"><span class="annot"><span class="annottext">supported :: Maybe (ValidityUpperBoundSupportedInEra era)
</span><a href="#local-6989586621679142294"><span class="hs-identifier hs-var hs-var">supported</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CardanoEra era -&gt; Maybe (ValidityUpperBoundSupportedInEra era)
forall era.
CardanoEra era -&gt; Maybe (ValidityUpperBoundSupportedInEra era)
</span><span class="hs-identifier hs-var">validityUpperBoundSupportedInEra</span></span><span> </span><span class="annot"><span class="annottext">CardanoEra era
forall era. IsCardanoEra era =&gt; CardanoEra era
</span><span class="hs-identifier hs-var">cardanoEra</span></span><span>
</span><span id="line-80"></span><span>  </span><span class="hs-keyword">in</span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-special">(</span><span>
</span><span id="line-82"></span><span>      </span><span class="annot"><span class="annottext">TxValidityLowerBound era
forall era. TxValidityLowerBound era
</span><span class="hs-identifier hs-var">TxValidityNoLowerBound</span></span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxValidityUpperBound era
-&gt; (ValidityUpperBoundSupportedInEra era
    -&gt; TxValidityUpperBound era)
-&gt; Maybe (ValidityUpperBoundSupportedInEra era)
-&gt; TxValidityUpperBound era
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span>
</span><span id="line-84"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValidityNoUpperBoundSupportedInEra era -&gt; TxValidityUpperBound era
forall era.
ValidityNoUpperBoundSupportedInEra era -&gt; TxValidityUpperBound era
</span><span class="hs-identifier hs-var">TxValidityNoUpperBound</span></span><span> </span><span class="annot"><span class="annottext">ValidityNoUpperBoundSupportedInEra era
</span><a href="#local-6989586621679142295"><span class="hs-identifier hs-var">notSupported</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValidityUpperBoundSupportedInEra era
-&gt; SlotNo -&gt; TxValidityUpperBound era
forall era.
ValidityUpperBoundSupportedInEra era
-&gt; SlotNo -&gt; TxValidityUpperBound era
</span><span class="hs-operator hs-var">`TxValidityUpperBound`</span></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679142296"><span class="hs-identifier hs-var">before</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>        </span><span class="annot"><span class="annottext">Maybe (ValidityUpperBoundSupportedInEra era)
</span><a href="#local-6989586621679142294"><span class="hs-identifier hs-var">supported</span></a></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-comment">-- | Make valid metadata.</span><span>
</span><span id="line-91"></span><span id="local-6989586621679142469"><span class="annot"><a href="Mantra.Transaction.html#validMetadata"><span class="hs-identifier hs-type">validMetadata</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IsCardanoEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679142469"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-92"></span><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxMetadata</span></span><span>    </span><span class="hs-comment">-- ^ The metadata, if any.</span><span>
</span><span id="line-93"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxMetadataInEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679142469"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-comment">-- ^ The metadata for the era.</span></span><span>
</span><span id="line-94"></span><span id="validMetadata"><span class="annot"><span class="annottext">validMetadata :: Maybe TxMetadata -&gt; TxMetadataInEra era
</span><a href="Mantra.Transaction.html#validMetadata"><span class="hs-identifier hs-var hs-var">validMetadata</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe TxMetadata
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxMetadataInEra era
forall era. TxMetadataInEra era
</span><span class="hs-identifier hs-var">TxMetadataNone</span></span><span>
</span><span id="line-95"></span><span class="annot"><a href="Mantra.Transaction.html#validMetadata"><span class="hs-identifier hs-var">validMetadata</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679142289"><span class="annot"><span class="annottext">TxMetadata
</span><a href="#local-6989586621679142289"><span class="hs-identifier hs-var">metadata</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><span class="annottext">TxMetadataInEra era
-&gt; (TxMetadataSupportedInEra era -&gt; TxMetadataInEra era)
-&gt; Maybe (TxMetadataSupportedInEra era)
-&gt; TxMetadataInEra era
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span>
</span><span id="line-97"></span><span>    </span><span class="annot"><span class="annottext">TxMetadataInEra era
forall era. TxMetadataInEra era
</span><span class="hs-identifier hs-var">TxMetadataNone</span></span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxMetadataSupportedInEra era -&gt; TxMetadata -&gt; TxMetadataInEra era
forall era.
TxMetadataSupportedInEra era -&gt; TxMetadata -&gt; TxMetadataInEra era
</span><span class="hs-operator hs-var">`TxMetadataInEra`</span></span><span> </span><span class="annot"><span class="annottext">TxMetadata
</span><a href="#local-6989586621679142289"><span class="hs-identifier hs-var">metadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><span class="annottext">(Maybe (TxMetadataSupportedInEra era) -&gt; TxMetadataInEra era)
-&gt; Maybe (TxMetadataSupportedInEra era) -&gt; TxMetadataInEra era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CardanoEra era -&gt; Maybe (TxMetadataSupportedInEra era)
forall era. CardanoEra era -&gt; Maybe (TxMetadataSupportedInEra era)
</span><span class="hs-identifier hs-var">txMetadataSupportedInEra</span></span><span> </span><span class="annot"><span class="annottext">CardanoEra era
forall era. IsCardanoEra era =&gt; CardanoEra era
</span><span class="hs-identifier hs-var">cardanoEra</span></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span id="local-6989586621679142444"><span class="annot"><a href="Mantra.Transaction.html#validMint"><span class="hs-identifier hs-type">validMint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IsCardanoEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679142444"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-103"></span><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PolicyId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SimpleScript</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SimpleScriptV2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ The policy, script, and value, if any.</span><span>
</span><span id="line-104"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxMintValue</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BuildTx</span></span><span> </span><span class="annot"><a href="#local-6989586621679142444"><span class="hs-identifier hs-type">era</span></a></span><span>                              </span><span class="hs-comment">-- ^ The minting for the era.</span></span><span>
</span><span id="line-105"></span><span id="validMint"><span class="annot"><span class="annottext">validMint :: Maybe (PolicyId, SimpleScript SimpleScriptV2, Value)
-&gt; TxMintValue BuildTx era
</span><a href="Mantra.Transaction.html#validMint"><span class="hs-identifier hs-var hs-var">validMint</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (PolicyId, SimpleScript SimpleScriptV2, Value)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxMintValue BuildTx era
forall build era. TxMintValue build era
</span><span class="hs-identifier hs-var">TxMintNone</span></span><span>
</span><span id="line-106"></span><span class="annot"><a href="Mantra.Transaction.html#validMint"><span class="hs-identifier hs-var">validMint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679142285"><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621679142285"><span class="hs-identifier hs-var">policy</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679142284"><span class="annot"><span class="annottext">SimpleScript SimpleScriptV2
</span><a href="#local-6989586621679142284"><span class="hs-identifier hs-var">script</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679142283"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679142283"><span class="hs-identifier hs-var">value</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CardanoEra era
-&gt; Either
     (OnlyAdaSupportedInEra era) (MultiAssetSupportedInEra era)
forall era.
CardanoEra era
-&gt; Either
     (OnlyAdaSupportedInEra era) (MultiAssetSupportedInEra era)
</span><span class="hs-identifier hs-var">multiAssetSupportedInEra</span></span><span> </span><span class="annot"><span class="annottext">CardanoEra era
forall era. IsCardanoEra era =&gt; CardanoEra era
</span><span class="hs-identifier hs-var">cardanoEra</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CardanoEra era
-&gt; ScriptLanguage SimpleScriptV2
-&gt; Maybe (ScriptLanguageInEra SimpleScriptV2 era)
forall era lang.
CardanoEra era
-&gt; ScriptLanguage lang -&gt; Maybe (ScriptLanguageInEra lang era)
</span><span class="hs-identifier hs-var">scriptLanguageSupportedInEra</span></span><span> </span><span class="annot"><span class="annottext">CardanoEra era
forall era. IsCardanoEra era =&gt; CardanoEra era
</span><span class="hs-identifier hs-var">cardanoEra</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimpleScriptVersion SimpleScriptV2 -&gt; ScriptLanguage SimpleScriptV2
forall lang. SimpleScriptVersion lang -&gt; ScriptLanguage lang
</span><span class="hs-identifier hs-var">SimpleScriptLanguage</span></span><span> </span><span class="annot"><span class="annottext">SimpleScriptVersion SimpleScriptV2
</span><span class="hs-identifier hs-var">SimpleScriptV2</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679142280"><span class="annot"><span class="annottext">MultiAssetSupportedInEra era
</span><a href="#local-6989586621679142280"><span class="hs-identifier hs-var">supportedMultiAsset</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679142279"><span class="annot"><span class="annottext">ScriptLanguageInEra SimpleScriptV2 era
</span><a href="#local-6989586621679142279"><span class="hs-identifier hs-var">supportedScript</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MultiAssetSupportedInEra era
-&gt; Value
-&gt; BuildTxWith
     BuildTx (Map PolicyId (ScriptWitness WitCtxMint era))
-&gt; TxMintValue BuildTx era
forall era build.
MultiAssetSupportedInEra era
-&gt; Value
-&gt; BuildTxWith build (Map PolicyId (ScriptWitness WitCtxMint era))
-&gt; TxMintValue build era
</span><span class="hs-identifier hs-var">TxMintValue</span></span><span> </span><span class="annot"><span class="annottext">MultiAssetSupportedInEra era
</span><a href="#local-6989586621679142280"><span class="hs-identifier hs-var">supportedMultiAsset</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679142283"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-109"></span><span>                                                           </span><span class="annot"><span class="annottext">(BuildTxWith BuildTx (Map PolicyId (ScriptWitness WitCtxMint era))
 -&gt; TxMintValue BuildTx era)
-&gt; (ScriptWitness WitCtxMint era
    -&gt; BuildTxWith
         BuildTx (Map PolicyId (ScriptWitness WitCtxMint era)))
-&gt; ScriptWitness WitCtxMint era
-&gt; TxMintValue BuildTx era
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map PolicyId (ScriptWitness WitCtxMint era)
-&gt; BuildTxWith
     BuildTx (Map PolicyId (ScriptWitness WitCtxMint era))
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">BuildTxWith</span></span><span>
</span><span id="line-110"></span><span>                                                           </span><span class="annot"><span class="annottext">(Map PolicyId (ScriptWitness WitCtxMint era)
 -&gt; BuildTxWith
      BuildTx (Map PolicyId (ScriptWitness WitCtxMint era)))
-&gt; (ScriptWitness WitCtxMint era
    -&gt; Map PolicyId (ScriptWitness WitCtxMint era))
-&gt; ScriptWitness WitCtxMint era
-&gt; BuildTxWith
     BuildTx (Map PolicyId (ScriptWitness WitCtxMint era))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
-&gt; ScriptWitness WitCtxMint era
-&gt; Map PolicyId (ScriptWitness WitCtxMint era)
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621679142285"><span class="hs-identifier hs-var">policy</span></a></span><span>
</span><span id="line-111"></span><span>                                                           </span><span class="annot"><span class="annottext">(ScriptWitness WitCtxMint era -&gt; TxMintValue BuildTx era)
-&gt; ScriptWitness WitCtxMint era -&gt; TxMintValue BuildTx era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScriptLanguageInEra SimpleScriptV2 era
-&gt; SimpleScriptVersion SimpleScriptV2
-&gt; SimpleScript SimpleScriptV2
-&gt; ScriptWitness WitCtxMint era
forall lang era witctx.
ScriptLanguageInEra lang era
-&gt; SimpleScriptVersion lang
-&gt; SimpleScript lang
-&gt; ScriptWitness witctx era
</span><span class="hs-identifier hs-var">SimpleScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptLanguageInEra SimpleScriptV2 era
</span><a href="#local-6989586621679142279"><span class="hs-identifier hs-var">supportedScript</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleScriptVersion SimpleScriptV2
</span><span class="hs-identifier hs-var">SimpleScriptV2</span></span><span> </span><span class="annot"><span class="annottext">SimpleScript SimpleScriptV2
</span><a href="#local-6989586621679142284"><span class="hs-identifier hs-var">script</span></a></span><span>
</span><span id="line-112"></span><span>    </span><span class="annot"><span class="annottext">(Either (OnlyAdaSupportedInEra era) (MultiAssetSupportedInEra era),
 Maybe (ScriptLanguageInEra SimpleScriptV2 era))
</span><span class="hs-identifier">_</span></span><span>                                                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxMintValue BuildTx era
forall build era. TxMintValue build era
</span><span class="hs-identifier hs-var">TxMintNone</span></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-comment">-- | Build a transaction.</span><span>
</span><span id="line-116"></span><span id="local-6989586621679142274"><span class="annot"><a href="Mantra.Transaction.html#makeTransaction"><span class="hs-identifier hs-type">makeTransaction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IsCardanoEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679142274"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-117"></span><span>                </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">]</span><span>                                               </span><span class="hs-comment">-- ^ The UTxOs to be spent.</span><span>
</span><span id="line-118"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><a href="#local-6989586621679142274"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">]</span><span>                                          </span><span class="hs-comment">-- ^ The output UTxOs.</span><span>
</span><span id="line-119"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span>                                         </span><span class="hs-comment">-- ^ The latest slot for the transaction.</span><span>
</span><span id="line-120"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxMetadata</span></span><span>                                     </span><span class="hs-comment">-- ^ The metadata.</span><span>
</span><span id="line-121"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PolicyId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SimpleScript</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SimpleScriptV2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ The value to be minted.</span><span>
</span><span id="line-122"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxBodyContent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BuildTx</span></span><span> </span><span class="annot"><a href="#local-6989586621679142274"><span class="hs-identifier hs-type">era</span></a></span><span>                            </span><span class="hs-comment">-- ^ Action for building the transaction.</span></span><span>
</span><span id="line-123"></span><span id="makeTransaction"><span class="annot"><span class="annottext">makeTransaction :: [TxIn]
-&gt; [TxOut era]
-&gt; Maybe SlotNo
-&gt; Maybe TxMetadata
-&gt; Maybe (PolicyId, SimpleScript SimpleScriptV2, Value)
-&gt; TxBodyContent BuildTx era
</span><a href="Mantra.Transaction.html#makeTransaction"><span class="hs-identifier hs-var hs-var">makeTransaction</span></a></span></span><span> </span><span id="local-6989586621679142273"><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621679142273"><span class="hs-identifier hs-var">txIns'</span></a></span></span><span> </span><span id="local-6989586621679142272"><span class="annot"><span class="annottext">[TxOut era]
</span><a href="#local-6989586621679142272"><span class="hs-identifier hs-var">txOuts</span></a></span></span><span> </span><span id="local-6989586621679142271"><span class="annot"><span class="annottext">Maybe SlotNo
</span><a href="#local-6989586621679142271"><span class="hs-identifier hs-var">before</span></a></span></span><span> </span><span id="local-6989586621679142270"><span class="annot"><span class="annottext">Maybe TxMetadata
</span><a href="#local-6989586621679142270"><span class="hs-identifier hs-var">metadata</span></a></span></span><span> </span><span id="local-6989586621679142269"><span class="annot"><span class="annottext">Maybe (PolicyId, SimpleScript SimpleScriptV2, Value)
</span><a href="#local-6989586621679142269"><span class="hs-identifier hs-var">minting</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-125"></span><span>    </span><span id="local-6989586621679142268"><span class="annot"><span class="annottext">txIns :: [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn era))]
</span><a href="#local-6989586621679142268"><span class="hs-identifier hs-var hs-var">txIns</span></a></span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-special">,</span></span><span> </span><span class="annot"><span class="annottext">Witness WitCtxTxIn era
-&gt; BuildTxWith BuildTx (Witness WitCtxTxIn era)
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">(Witness WitCtxTxIn era
 -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn era))
-&gt; Witness WitCtxTxIn era
-&gt; BuildTxWith BuildTx (Witness WitCtxTxIn era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KeyWitnessInCtx WitCtxTxIn -&gt; Witness WitCtxTxIn era
forall witctx era. KeyWitnessInCtx witctx -&gt; Witness witctx era
</span><span class="hs-identifier hs-var">KeyWitness</span></span><span> </span><span class="annot"><span class="annottext">KeyWitnessInCtx WitCtxTxIn
</span><span class="hs-identifier hs-var">KeyWitnessForSpending</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TxIn -&gt; (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn era)))
-&gt; [TxIn] -&gt; [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn era))]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621679142273"><span class="hs-identifier hs-var">txIns'</span></a></span><span>
</span><span id="line-126"></span><span>    </span><span id="local-6989586621679142264"><span class="annot"><span class="annottext">txInsCollateral :: TxInsCollateral era
</span><a href="#local-6989586621679142264"><span class="hs-identifier hs-var hs-var">txInsCollateral</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxInsCollateral era
forall era. TxInsCollateral era
</span><span class="hs-identifier hs-var">TxInsCollateralNone</span></span><span>
</span><span id="line-127"></span><span>    </span><span id="local-6989586621679142262"><span class="annot"><span class="annottext">txFee :: TxFee era
</span><a href="#local-6989586621679142262"><span class="hs-identifier hs-var hs-var">txFee</span></a></span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lovelace -&gt; TxFee era
forall era. IsCardanoEra era =&gt; Lovelace -&gt; TxFee era
</span><a href="Mantra.Transaction.html#validFee"><span class="hs-identifier hs-var">validFee</span></a></span><span> </span><span class="annot"><span class="annottext">Lovelace
</span><span class="hs-number">0</span></span><span>
</span><span id="line-128"></span><span>    </span><span id="local-6989586621679142261"><span class="annot"><span class="annottext">txValidityRange :: (TxValidityLowerBound era, TxValidityUpperBound era)
</span><a href="#local-6989586621679142261"><span class="hs-identifier hs-var hs-var">txValidityRange</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SlotNo
-&gt; (TxValidityLowerBound era, TxValidityUpperBound era)
forall era.
IsCardanoEra era =&gt;
Maybe SlotNo
-&gt; (TxValidityLowerBound era, TxValidityUpperBound era)
</span><a href="Mantra.Transaction.html#validRange"><span class="hs-identifier hs-var">validRange</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SlotNo
</span><a href="#local-6989586621679142271"><span class="hs-identifier hs-var">before</span></a></span><span>
</span><span id="line-129"></span><span>    </span><span id="local-6989586621679142260"><span class="annot"><span class="annottext">txMetadata :: TxMetadataInEra era
</span><a href="#local-6989586621679142260"><span class="hs-identifier hs-var hs-var">txMetadata</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TxMetadata -&gt; TxMetadataInEra era
forall era.
IsCardanoEra era =&gt;
Maybe TxMetadata -&gt; TxMetadataInEra era
</span><a href="Mantra.Transaction.html#validMetadata"><span class="hs-identifier hs-var">validMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TxMetadata
</span><a href="#local-6989586621679142270"><span class="hs-identifier hs-var">metadata</span></a></span><span>
</span><span id="line-130"></span><span>    </span><span id="local-6989586621679142259"><span class="annot"><span class="annottext">txAuxScripts :: TxAuxScripts era
</span><a href="#local-6989586621679142259"><span class="hs-identifier hs-var hs-var">txAuxScripts</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxAuxScripts era
forall era. TxAuxScripts era
</span><span class="hs-identifier hs-var">TxAuxScriptsNone</span></span><span>
</span><span id="line-131"></span><span>    </span><span id="local-6989586621679142257"><span class="annot"><span class="annottext">txExtraScriptData :: BuildTxWith BuildTx (TxExtraScriptData era)
</span><a href="#local-6989586621679142257"><span class="hs-identifier hs-var hs-var">txExtraScriptData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxExtraScriptData era
-&gt; BuildTxWith BuildTx (TxExtraScriptData era)
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">TxExtraScriptData era
forall era. TxExtraScriptData era
</span><span class="hs-identifier hs-var">TxExtraScriptDataNone</span></span><span>
</span><span id="line-132"></span><span>    </span><span id="local-6989586621679142255"><span class="annot"><span class="annottext">txExtraKeyWits :: TxExtraKeyWitnesses era
</span><a href="#local-6989586621679142255"><span class="hs-identifier hs-var hs-var">txExtraKeyWits</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxExtraKeyWitnesses era
forall era. TxExtraKeyWitnesses era
</span><span class="hs-identifier hs-var">TxExtraKeyWitnessesNone</span></span><span>
</span><span id="line-133"></span><span>    </span><span id="local-6989586621679142253"><span class="annot"><span class="annottext">txProtocolParams :: BuildTxWith BuildTx (Maybe a)
</span><a href="#local-6989586621679142253"><span class="hs-identifier hs-var hs-var">txProtocolParams</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; BuildTxWith BuildTx (Maybe a)
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-134"></span><span>    </span><span id="local-6989586621679142252"><span class="annot"><span class="annottext">txWithdrawals :: TxWithdrawals build era
</span><a href="#local-6989586621679142252"><span class="hs-identifier hs-var hs-var">txWithdrawals</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxWithdrawals build era
forall build era. TxWithdrawals build era
</span><span class="hs-identifier hs-var">TxWithdrawalsNone</span></span><span>
</span><span id="line-135"></span><span>    </span><span id="local-6989586621679142250"><span class="annot"><span class="annottext">txCertificates :: TxCertificates build era
</span><a href="#local-6989586621679142250"><span class="hs-identifier hs-var hs-var">txCertificates</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxCertificates build era
forall build era. TxCertificates build era
</span><span class="hs-identifier hs-var">TxCertificatesNone</span></span><span>
</span><span id="line-136"></span><span>    </span><span id="local-6989586621679142248"><span class="annot"><span class="annottext">txUpdateProposal :: TxUpdateProposal era
</span><a href="#local-6989586621679142248"><span class="hs-identifier hs-var hs-var">txUpdateProposal</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxUpdateProposal era
forall era. TxUpdateProposal era
</span><span class="hs-identifier hs-var">TxUpdateProposalNone</span></span><span>
</span><span id="line-137"></span><span>    </span><span id="local-6989586621679142246"><span class="annot"><span class="annottext">txMintValue :: TxMintValue BuildTx era
</span><a href="#local-6989586621679142246"><span class="hs-identifier hs-var hs-var">txMintValue</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (PolicyId, SimpleScript SimpleScriptV2, Value)
-&gt; TxMintValue BuildTx era
forall era.
IsCardanoEra era =&gt;
Maybe (PolicyId, SimpleScript SimpleScriptV2, Value)
-&gt; TxMintValue BuildTx era
</span><a href="Mantra.Transaction.html#validMint"><span class="hs-identifier hs-var">validMint</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (PolicyId, SimpleScript SimpleScriptV2, Value)
</span><a href="#local-6989586621679142269"><span class="hs-identifier hs-var">minting</span></a></span><span>
</span><span id="line-138"></span><span>    </span><span id="local-6989586621679142245"><span class="annot"><span class="annottext">txScriptValidity :: TxScriptValidity era
</span><a href="#local-6989586621679142245"><span class="hs-identifier hs-var hs-var">txScriptValidity</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxScriptValidity era
forall era. TxScriptValidity era
</span><span class="hs-identifier hs-var">TxScriptValidityNone</span></span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-keyword">in</span><span>
</span><span id="line-140"></span><span>    </span><span class="annot"><span class="annottext">TxBodyContent :: forall build era.
TxIns build era
-&gt; TxInsCollateral era
-&gt; [TxOut era]
-&gt; TxFee era
-&gt; (TxValidityLowerBound era, TxValidityUpperBound era)
-&gt; TxMetadataInEra era
-&gt; TxAuxScripts era
-&gt; BuildTxWith build (TxExtraScriptData era)
-&gt; TxExtraKeyWitnesses era
-&gt; BuildTxWith build (Maybe ProtocolParameters)
-&gt; TxWithdrawals build era
-&gt; TxCertificates build era
-&gt; TxUpdateProposal era
-&gt; TxMintValue build era
-&gt; TxScriptValidity era
-&gt; TxBodyContent build era
</span><span class="hs-identifier hs-type">TxBodyContent</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">[(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn era))]
[TxOut era]
(TxValidityLowerBound era, TxValidityUpperBound era)
BuildTxWith BuildTx (Maybe ProtocolParameters)
BuildTxWith BuildTx (TxExtraScriptData era)
TxAuxScripts era
TxCertificates BuildTx era
TxExtraKeyWitnesses era
TxFee era
TxInsCollateral era
TxMetadataInEra era
TxMintValue BuildTx era
TxScriptValidity era
TxUpdateProposal era
TxWithdrawals BuildTx era
forall a. BuildTxWith BuildTx (Maybe a)
forall era. BuildTxWith BuildTx (TxExtraScriptData era)
forall era. TxAuxScripts era
forall era. TxExtraKeyWitnesses era
forall era. TxInsCollateral era
forall era. TxScriptValidity era
forall era. TxUpdateProposal era
forall build era. TxCertificates build era
forall build era. TxWithdrawals build era
txWithdrawals :: TxWithdrawals BuildTx era
txValidityRange :: (TxValidityLowerBound era, TxValidityUpperBound era)
txUpdateProposal :: TxUpdateProposal era
txScriptValidity :: TxScriptValidity era
txProtocolParams :: BuildTxWith BuildTx (Maybe ProtocolParameters)
txOuts :: [TxOut era]
txMintValue :: TxMintValue BuildTx era
txMetadata :: TxMetadataInEra era
txInsCollateral :: TxInsCollateral era
txIns :: [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn era))]
txFee :: TxFee era
txExtraScriptData :: BuildTxWith BuildTx (TxExtraScriptData era)
txExtraKeyWits :: TxExtraKeyWitnesses era
txCertificates :: TxCertificates BuildTx era
txAuxScripts :: TxAuxScripts era
txScriptValidity :: forall era. TxScriptValidity era
txMintValue :: TxMintValue BuildTx era
txUpdateProposal :: forall era. TxUpdateProposal era
txCertificates :: forall build era. TxCertificates build era
txWithdrawals :: forall build era. TxWithdrawals build era
txProtocolParams :: forall a. BuildTxWith BuildTx (Maybe a)
txExtraKeyWits :: forall era. TxExtraKeyWitnesses era
txExtraScriptData :: forall era. BuildTxWith BuildTx (TxExtraScriptData era)
txAuxScripts :: forall era. TxAuxScripts era
txMetadata :: TxMetadataInEra era
txValidityRange :: (TxValidityLowerBound era, TxValidityUpperBound era)
txFee :: TxFee era
txInsCollateral :: forall era. TxInsCollateral era
txIns :: [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn era))]
txOuts :: [TxOut era]
</span><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></span><span class="hs-special">}</span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-comment">-- | Include the fee in a transaction.</span><span>
</span><span id="line-144"></span><span id="local-6989586621679142226"><span id="local-6989586621679142227"><span class="annot"><a href="Mantra.Transaction.html#includeFee"><span class="hs-identifier hs-type">includeFee</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IsShelleyBasedEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679142227"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-145"></span><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679142226"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-146"></span><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679142226"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-147"></span><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NetworkId</span></span><span>                             </span><span class="hs-comment">-- ^ The network.</span><span>
</span><span id="line-148"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProtocolParameters</span></span><span>                    </span><span class="hs-comment">-- ^ The protocol parameters.</span><span>
</span><span id="line-149"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>                                   </span><span class="hs-comment">-- ^ The number of inputs.</span><span>
</span><span id="line-150"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>                                   </span><span class="hs-comment">-- ^ The number of outputs.</span><span>
</span><span id="line-151"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>                                   </span><span class="hs-comment">-- ^ The number of Shelley witnesses.</span><span>
</span><span id="line-152"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>                                   </span><span class="hs-comment">-- ^ The number of Byron witnesses.</span><span>
</span><span id="line-153"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxBodyContent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BuildTx</span></span><span> </span><span class="annot"><a href="#local-6989586621679142227"><span class="hs-identifier hs-type">era</span></a></span><span>             </span><span class="hs-comment">-- ^ The transaction body.</span><span>
</span><span id="line-154"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Mantra.Types.html#MantraM"><span class="hs-identifier hs-type">MantraM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679142226"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxBodyContent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BuildTx</span></span><span> </span><span class="annot"><a href="#local-6989586621679142227"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Action for the transaction body with fee included.</span></span></span><span>
</span><span id="line-155"></span><span id="includeFee"><span class="annot"><span class="annottext">includeFee :: NetworkId
-&gt; ProtocolParameters
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; TxBodyContent BuildTx era
-&gt; MantraM m (TxBodyContent BuildTx era)
</span><a href="Mantra.Transaction.html#includeFee"><span class="hs-identifier hs-var hs-var">includeFee</span></a></span></span><span> </span><span id="local-6989586621679142225"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621679142225"><span class="hs-identifier hs-var">network</span></a></span></span><span> </span><span id="local-6989586621679142224"><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621679142224"><span class="hs-identifier hs-var">pparams</span></a></span></span><span> </span><span id="local-6989586621679142223"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679142223"><span class="hs-identifier hs-var">nIn</span></a></span></span><span> </span><span id="local-6989586621679142222"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679142222"><span class="hs-identifier hs-var">nOut</span></a></span></span><span> </span><span id="local-6989586621679142221"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679142221"><span class="hs-identifier hs-var">nShelley</span></a></span></span><span> </span><span id="local-6989586621679142220"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679142220"><span class="hs-identifier hs-var">nByron</span></a></span></span><span> </span><span id="local-6989586621679142219"><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621679142219"><span class="hs-identifier hs-var">content</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-157"></span><span>    </span><span id="local-6989586621679142218"><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621679142218"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Either TxBodyError (TxBody era) -&gt; MantraM m (TxBody era)
forall (m :: * -&gt; *) e a.
(Monad m, Show e) =&gt;
Either e a -&gt; MantraM m a
</span><a href="Mantra.Types.html#foistMantraEither"><span class="hs-identifier hs-var">foistMantraEither</span></a></span><span> </span><span class="annot"><span class="annottext">(Either TxBodyError (TxBody era) -&gt; MantraM m (TxBody era))
-&gt; Either TxBodyError (TxBody era) -&gt; MantraM m (TxBody era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era -&gt; Either TxBodyError (TxBody era)
forall era.
IsCardanoEra era =&gt;
TxBodyContent BuildTx era -&gt; Either TxBodyError (TxBody era)
</span><span class="hs-identifier hs-var">makeTransactionBody</span></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621679142219"><span class="hs-identifier hs-var">content</span></a></span><span>
</span><span id="line-158"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-159"></span><span>      </span><span id="local-6989586621679142217"><span class="annot"><span class="annottext">tx :: Tx era
</span><a href="#local-6989586621679142217"><span class="hs-identifier hs-var hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[KeyWitness era] -&gt; TxBody era -&gt; Tx era
forall era. [KeyWitness era] -&gt; TxBody era -&gt; Tx era
</span><span class="hs-identifier hs-var">makeSignedTransaction</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621679142218"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-160"></span><span>      </span><span id="local-6989586621679142216"><span class="annot"><span class="annottext">lovelace :: Lovelace
</span><a href="#local-6989586621679142216"><span class="hs-identifier hs-var hs-var">lovelace</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkId
-&gt; Natural
-&gt; Natural
-&gt; Tx era
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; Lovelace
forall era.
IsShelleyBasedEra era =&gt;
NetworkId
-&gt; Natural
-&gt; Natural
-&gt; Tx era
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; Lovelace
</span><span class="hs-identifier hs-var">estimateTransactionFee</span></span><span>
</span><span id="line-161"></span><span>        </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621679142225"><span class="hs-identifier hs-var">network</span></a></span><span>
</span><span id="line-162"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProtocolParameters -&gt; Natural
</span><span class="hs-identifier hs-var hs-var">protocolParamTxFeeFixed</span></span><span>   </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621679142224"><span class="hs-identifier hs-var">pparams</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProtocolParameters -&gt; Natural
</span><span class="hs-identifier hs-var hs-var">protocolParamTxFeePerByte</span></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><a href="#local-6989586621679142224"><span class="hs-identifier hs-var">pparams</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>        </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679142217"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-165"></span><span>        </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679142223"><span class="hs-identifier hs-var">nIn</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679142222"><span class="hs-identifier hs-var">nOut</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679142221"><span class="hs-identifier hs-var">nShelley</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679142220"><span class="hs-identifier hs-var">nByron</span></a></span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span id="local-6989586621679142214"><span class="annot"><span class="annottext">AddressInEra era
</span><a href="#local-6989586621679142214"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxOutValue</span></span><span> </span><span id="local-6989586621679142212"><span class="annot"><span class="annottext">MultiAssetSupportedInEra era
</span><a href="#local-6989586621679142212"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679142211"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679142211"><span class="hs-identifier hs-var">value</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxOutDatumHash era
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TxOut era] -&gt; MantraM m [TxOut era]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([TxOut era] -&gt; MantraM m [TxOut era])
-&gt; [TxOut era] -&gt; MantraM m [TxOut era]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era -&gt; [TxOut era]
forall build era. TxBodyContent build era -&gt; [TxOut era]
</span><span class="hs-identifier hs-var hs-var">txOuts</span></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621679142219"><span class="hs-identifier hs-var">content</span></a></span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-168"></span><span>      </span><span id="local-6989586621679142210"><span class="annot"><span class="annottext">fee :: Value
</span><a href="#local-6989586621679142210"><span class="hs-identifier hs-var hs-var">fee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value
</span><span class="hs-identifier hs-var">negateValue</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Value) -&gt; Value -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Lovelace -&gt; Value
</span><span class="hs-identifier hs-var">lovelaceToValue</span></span><span> </span><span class="annot"><span class="annottext">Lovelace
</span><a href="#local-6989586621679142216"><span class="hs-identifier hs-var">lovelace</span></a></span><span>
</span><span id="line-169"></span><span>    </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era -&gt; MantraM m (TxBodyContent BuildTx era)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-170"></span><span>      </span><span class="annot"><span class="annottext">(TxBodyContent BuildTx era
 -&gt; MantraM m (TxBodyContent BuildTx era))
-&gt; TxBodyContent BuildTx era
-&gt; MantraM m (TxBodyContent BuildTx era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx era
</span><a href="#local-6989586621679142219"><span class="hs-identifier hs-var">content</span></a></span><span>
</span><span id="line-171"></span><span>        </span><span class="hs-special">{</span><span>
</span><span id="line-172"></span><span>          </span><span class="annot"><span class="annottext">txFee :: TxFee era
</span><span class="hs-identifier hs-var">txFee</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lovelace -&gt; TxFee era
forall era. IsCardanoEra era =&gt; Lovelace -&gt; TxFee era
</span><a href="Mantra.Transaction.html#validFee"><span class="hs-identifier hs-var">validFee</span></a></span><span> </span><span class="annot"><span class="annottext">Lovelace
</span><a href="#local-6989586621679142216"><span class="hs-identifier hs-var">lovelace</span></a></span><span>
</span><span id="line-173"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txOuts :: [TxOut era]
</span><span class="hs-identifier hs-var">txOuts</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AddressInEra era
-&gt; TxOutValue era -&gt; TxOutDatumHash era -&gt; TxOut era
forall era.
AddressInEra era
-&gt; TxOutValue era -&gt; TxOutDatumHash era -&gt; TxOut era
</span><span class="hs-identifier hs-var">TxOut</span></span><span> </span><span class="annot"><span class="annottext">AddressInEra era
</span><a href="#local-6989586621679142214"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MultiAssetSupportedInEra era -&gt; Value -&gt; TxOutValue era
forall era. MultiAssetSupportedInEra era -&gt; Value -&gt; TxOutValue era
</span><span class="hs-identifier hs-var">TxOutValue</span></span><span> </span><span class="annot"><span class="annottext">MultiAssetSupportedInEra era
</span><a href="#local-6989586621679142212"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; TxOutValue era) -&gt; Value -&gt; TxOutValue era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679142211"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679142210"><span class="hs-identifier hs-var">fee</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxOutDatumHash era
forall era. TxOutDatumHash era
</span><span class="hs-identifier hs-var">TxOutDatumHashNone</span></span><span class="hs-special">]</span><span>
</span><span id="line-174"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="hs-comment">-- | Read JSON metadata from a file.</span><span>
</span><span id="line-178"></span><span id="local-6989586621679142394"><span class="annot"><a href="Mantra.Transaction.html#readMetadata%27"><span class="hs-identifier hs-type">readMetadata'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679142394"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-179"></span><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>                        </span><span class="hs-comment">-- ^ Path to the metadata file.</span><span>
</span><span id="line-180"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Mantra.Types.html#MantraM"><span class="hs-identifier hs-type">MantraM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679142394"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">A.Value</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxMetadata</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Action for reading the file as JSON and metadata.</span></span><span>
</span><span id="line-181"></span><span id="readMetadata%27"><span class="annot"><span class="annottext">readMetadata' :: FilePath -&gt; MantraM m (Value, TxMetadata)
</span><a href="Mantra.Transaction.html#readMetadata%27"><span class="hs-identifier hs-var hs-var">readMetadata'</span></a></span></span><span> </span><span id="local-6989586621679142207"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679142207"><span class="hs-identifier hs-var">filename</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-182"></span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-183"></span><span>    </span><span id="local-6989586621679142206"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679142206"><span class="hs-identifier hs-var">json</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-184"></span><span>      </span><span class="annot"><span class="annottext">FilePath -&gt; IO (Maybe Value) -&gt; MantraM m Value
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
FilePath -&gt; IO (Maybe a) -&gt; MantraM m a
</span><a href="Mantra.Types.html#foistMantraMaybeIO"><span class="hs-identifier hs-var">foistMantraMaybeIO</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Could not decode metadata.&quot;</span></span><span>
</span><span id="line-185"></span><span>        </span><span class="annot"><span class="annottext">(IO (Maybe Value) -&gt; MantraM m Value)
-&gt; IO (Maybe Value) -&gt; MantraM m Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO (Maybe Value)
forall a. FromJSON a =&gt; FilePath -&gt; IO (Maybe a)
</span><span class="hs-identifier hs-var">A.decodeFileStrict</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679142207"><span class="hs-identifier hs-var">filename</span></a></span><span>
</span><span id="line-186"></span><span>    </span><span id="local-6989586621679142205"><span class="annot"><span class="annottext">TxMetadata
</span><a href="#local-6989586621679142205"><span class="hs-identifier hs-var">metadata</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-187"></span><span>      </span><span class="annot"><span class="annottext">Either TxMetadataJsonError TxMetadata -&gt; MantraM m TxMetadata
forall (m :: * -&gt; *) e a.
(Monad m, Show e) =&gt;
Either e a -&gt; MantraM m a
</span><a href="Mantra.Types.html#foistMantraEither"><span class="hs-identifier hs-var">foistMantraEither</span></a></span><span>
</span><span id="line-188"></span><span>        </span><span class="annot"><span class="annottext">(Either TxMetadataJsonError TxMetadata -&gt; MantraM m TxMetadata)
-&gt; Either TxMetadataJsonError TxMetadata -&gt; MantraM m TxMetadata
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TxMetadataJsonSchema
-&gt; Value -&gt; Either TxMetadataJsonError TxMetadata
</span><span class="hs-identifier hs-var">metadataFromJson</span></span><span> </span><span class="annot"><span class="annottext">TxMetadataJsonSchema
</span><span class="hs-identifier hs-var">TxMetadataJsonNoSchema</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679142206"><span class="hs-identifier hs-var">json</span></a></span><span>
</span><span id="line-189"></span><span>    </span><span class="annot"><span class="annottext">(Value, TxMetadata) -&gt; MantraM m (Value, TxMetadata)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679142206"><span class="hs-identifier hs-var">json</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxMetadata
</span><a href="#local-6989586621679142205"><span class="hs-identifier hs-var">metadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="hs-comment">-- | Read JSON metadata from a file.</span><span>
</span><span id="line-193"></span><span id="local-6989586621679142203"><span class="annot"><a href="Mantra.Transaction.html#readMetadata"><span class="hs-identifier hs-type">readMetadata</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679142203"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-194"></span><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>             </span><span class="hs-comment">-- ^ Path to the metadata file.</span><span>
</span><span id="line-195"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Mantra.Types.html#MantraM"><span class="hs-identifier hs-type">MantraM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679142203"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxMetadata</span></span><span> </span><span class="hs-comment">-- ^ Action for reading the file as metadata.</span></span><span>
</span><span id="line-196"></span><span id="readMetadata"><span class="annot"><span class="annottext">readMetadata :: FilePath -&gt; MantraM m TxMetadata
</span><a href="Mantra.Transaction.html#readMetadata"><span class="hs-identifier hs-var hs-var">readMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Value, TxMetadata) -&gt; TxMetadata)
-&gt; MantraM m (Value, TxMetadata) -&gt; MantraM m TxMetadata
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(Value, TxMetadata) -&gt; TxMetadata
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(MantraM m (Value, TxMetadata) -&gt; MantraM m TxMetadata)
-&gt; (FilePath -&gt; MantraM m (Value, TxMetadata))
-&gt; FilePath
-&gt; MantraM m TxMetadata
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; MantraM m (Value, TxMetadata)
forall (m :: * -&gt; *).
MonadIO m =&gt;
FilePath -&gt; MantraM m (Value, TxMetadata)
</span><a href="Mantra.Transaction.html#readMetadata%27"><span class="hs-identifier hs-var">readMetadata'</span></a></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="hs-comment">-- | Print information about a UTxO.</span><span>
</span><span id="line-200"></span><span id="local-6989586621679142201"><span id="local-6989586621679142202"><span class="annot"><a href="Mantra.Transaction.html#printUTxO"><span class="hs-identifier hs-type">printUTxO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679142202"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-201"></span><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>       </span><span class="hs-comment">-- ^ How much to indent the output.</span><span>
</span><span id="line-202"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="annot"><a href="#local-6989586621679142201"><span class="hs-identifier hs-type">era</span></a></span><span>     </span><span class="hs-comment">-- ^ The UTxO.</span><span>
</span><span id="line-203"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Mantra.Types.html#MantraM"><span class="hs-identifier hs-type">MantraM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679142202"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Action to print the information.</span></span></span><span>
</span><span id="line-204"></span><span id="printUTxO"><span class="annot"><span class="annottext">printUTxO :: FilePath -&gt; UTxO era -&gt; MantraM m ()
</span><a href="Mantra.Transaction.html#printUTxO"><span class="hs-identifier hs-var hs-var">printUTxO</span></a></span></span><span> </span><span id="local-6989586621679142199"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679142199"><span class="hs-identifier hs-var">indent</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span id="local-6989586621679142197"><span class="annot"><span class="annottext">Map TxIn (TxOut era)
</span><a href="#local-6989586621679142197"><span class="hs-identifier hs-var">utxoMap</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-205"></span><span>  </span><span class="annot"><span class="annottext">[MantraM m ()] -&gt; MantraM m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, Monad m) =&gt;
t (m a) -&gt; m ()
</span><span class="hs-identifier hs-var">sequence_</span></span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-special">[</span><span>
</span><span id="line-207"></span><span>      </span><span class="hs-keyword">do</span><span>
</span><span id="line-208"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; MantraM m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span>
</span><span id="line-209"></span><span>          </span><span class="annot"><span class="annottext">(IO () -&gt; MantraM m ())
-&gt; (FilePath -&gt; IO ()) -&gt; FilePath -&gt; MantraM m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span>
</span><span id="line-210"></span><span>          </span><span class="annot"><span class="annottext">(FilePath -&gt; MantraM m ()) -&gt; FilePath -&gt; MantraM m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679142199"><span class="hs-identifier hs-var">indent</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Transaction: &quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Hash Blake2b_256 EraIndependentTxBody -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><a href="Mantra.Transaction.html#show%27"><span class="hs-identifier hs-var">show'</span></a></span><span> </span><span class="annot"><span class="annottext">Hash StandardCrypto EraIndependentTxBody
Hash Blake2b_256 EraIndependentTxBody
</span><a href="#local-6989586621679142193"><span class="hs-identifier hs-var">txhash</span></a></span><span>  </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;#&quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">TxIx -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">TxIx
</span><a href="#local-6989586621679142191"><span class="hs-identifier hs-var">txin</span></a></span><span>
</span><span id="line-211"></span><span>        </span><span class="annot"><span class="annottext">FilePath -&gt; Value -&gt; MantraM m ()
forall (m :: * -&gt; *).
MonadIO m =&gt;
FilePath -&gt; Value -&gt; MantraM m ()
</span><a href="Mantra.Transaction.html#printValue"><span class="hs-identifier hs-var">printValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679142199"><span class="hs-identifier hs-var">indent</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;  &quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679142190"><span class="hs-identifier hs-var">value'</span></a></span><span>
</span><span id="line-212"></span><span>    </span><span class="hs-glyph">|</span><span>
</span><span id="line-213"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxId</span></span><span> </span><span id="local-6989586621679142193"><span class="annot"><span class="annottext">Hash StandardCrypto EraIndependentTxBody
</span><a href="#local-6989586621679142193"><span class="hs-identifier hs-var">txhash</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679142191"><span class="annot"><span class="annottext">TxIx
</span><a href="#local-6989586621679142191"><span class="hs-identifier hs-var">txin</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="annottext">AddressInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxOutValue</span></span><span> </span><span class="annot"><span class="annottext">MultiAssetSupportedInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679142190"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679142190"><span class="hs-identifier hs-var">value'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxOutDatumHash era
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut era) -&gt; [(TxIn, TxOut era)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.assocs</span></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut era)
</span><a href="#local-6989586621679142197"><span class="hs-identifier hs-var">utxoMap</span></a></span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="hs-comment">-- | Print a value.</span><span>
</span><span id="line-218"></span><span id="local-6989586621679142377"><span class="annot"><a href="Mantra.Transaction.html#printValue"><span class="hs-identifier hs-type">printValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679142377"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-219"></span><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>       </span><span class="hs-comment">-- ^ How much to indent the output.</span><span>
</span><span id="line-220"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>        </span><span class="hs-comment">-- ^ The value.</span><span>
</span><span id="line-221"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Mantra.Types.html#MantraM"><span class="hs-identifier hs-type">MantraM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679142377"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Action to print the information.</span></span><span>
</span><span id="line-222"></span><span id="printValue"><span class="annot"><span class="annottext">printValue :: FilePath -&gt; Value -&gt; MantraM m ()
</span><a href="Mantra.Transaction.html#printValue"><span class="hs-identifier hs-var hs-var">printValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; MantraM m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; MantraM m ())
-&gt; (Value -&gt; IO ()) -&gt; Value -&gt; MantraM m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Value -&gt; IO ()) -&gt; Value -&gt; MantraM m ())
-&gt; (FilePath -&gt; Value -&gt; IO ())
-&gt; FilePath
-&gt; Value
-&gt; MantraM m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Value -&gt; IO ()
</span><a href="Mantra.Transaction.html#printValueIO"><span class="hs-identifier hs-var">printValueIO</span></a></span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="hs-comment">-- | Print a value.</span><span>
</span><span id="line-226"></span><span class="annot"><a href="Mantra.Transaction.html#printValueIO"><span class="hs-identifier hs-type">printValueIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-227"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="hs-comment">-- ^ The value.</span><span>
</span><span id="line-228"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Action to print the information.</span><span>
</span><span id="line-229"></span><span id="printValueIO"><span class="annot"><span class="annottext">printValueIO :: FilePath -&gt; Value -&gt; IO ()
</span><a href="Mantra.Transaction.html#printValueIO"><span class="hs-identifier hs-var hs-var">printValueIO</span></a></span></span><span> </span><span id="local-6989586621679142187"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679142187"><span class="hs-identifier hs-var">indent</span></a></span></span><span> </span><span id="local-6989586621679142186"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679142186"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-231"></span><span>    </span><span class="annot"><span class="annottext">FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO ()) -&gt; FilePath -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679142187"><span class="hs-identifier hs-var">indent</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Lovelace -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Lovelace
</span><span class="hs-identifier hs-var">selectLovelace</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679142186"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>    </span><span class="annot"><span class="annottext">[IO ()] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, Monad m) =&gt;
t (m a) -&gt; m ()
</span><span class="hs-identifier hs-var">sequence_</span></span><span>
</span><span id="line-233"></span><span>      </span><span class="hs-special">[</span><span>
</span><span id="line-234"></span><span>        </span><span class="annot"><span class="annottext">FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO ()) -&gt; FilePath -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679142187"><span class="hs-identifier hs-var">indent</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Quantity -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621679142185"><span class="hs-identifier hs-var">quantity</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;  &quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ScriptHash -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><a href="Mantra.Transaction.html#show%27"><span class="hs-identifier hs-var">show'</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679142184"><span class="hs-identifier hs-var">policy</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><a href="Mantra.Transaction.html#show%27"><span class="hs-identifier hs-var">show'</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679142183"><span class="hs-identifier hs-var">asset</span></a></span><span>
</span><span id="line-235"></span><span>      </span><span class="hs-glyph">|</span><span>
</span><span id="line-236"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AssetId</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PolicyId</span></span><span> </span><span id="local-6989586621679142184"><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679142184"><span class="hs-identifier hs-var">policy</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AssetName</span></span><span> </span><span id="local-6989586621679142183"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679142183"><span class="hs-identifier hs-var">asset</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679142185"><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621679142185"><span class="hs-identifier hs-var">quantity</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Value -&gt; [(AssetId, Quantity)]
</span><span class="hs-identifier hs-var">valueToList</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; [(AssetId, Quantity)]) -&gt; Value -&gt; [(AssetId, Quantity)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(AssetId -&gt; Bool) -&gt; Value -&gt; Value
</span><span class="hs-identifier hs-var">filterValue</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AssetId -&gt; AssetId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">AssetId
</span><span class="hs-identifier hs-var">AdaAssetId</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679142186"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-237"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span class="hs-comment">-- | Strip a leading and trailing quotation mark when showing a string.</span><span>
</span><span id="line-241"></span><span id="local-6989586621679142381"><span class="annot"><a href="Mantra.Transaction.html#show%27"><span class="hs-identifier hs-type">show'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679142381"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-242"></span><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679142381"><span class="hs-identifier hs-type">a</span></a></span><span>      </span><span class="hs-comment">-- ^ The value.</span><span>
</span><span id="line-243"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-comment">-- ^ The string represenation.</span></span><span>
</span><span id="line-244"></span><span id="show%27"><span class="annot"><span class="annottext">show' :: a -&gt; FilePath
</span><a href="Mantra.Transaction.html#show%27"><span class="hs-identifier hs-var hs-var">show'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">init</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; FilePath) -&gt; (a -&gt; FilePath) -&gt; a -&gt; FilePath
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; FilePath) -&gt; (a -&gt; FilePath) -&gt; a -&gt; FilePath
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><span class="hs-identifier hs-var">show</span></span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span class="hs-comment">-- | Summarize the values in a UTxO.</span><span>
</span><span id="line-248"></span><span id="local-6989586621679142175"><span class="annot"><a href="Mantra.Transaction.html#summarizeValues"><span class="hs-identifier hs-type">summarizeValues</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="annot"><a href="#local-6989586621679142175"><span class="hs-identifier hs-type">era</span></a></span><span>     </span><span class="hs-comment">-- ^ The UTxO.</span><span>
</span><span id="line-249"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ The number of values and their total.</span></span><span>
</span><span id="line-250"></span><span id="summarizeValues"><span class="annot"><span class="annottext">summarizeValues :: UTxO era -&gt; (Int, Value)
</span><a href="Mantra.Transaction.html#summarizeValues"><span class="hs-identifier hs-var hs-var">summarizeValues</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span id="local-6989586621679142174"><span class="annot"><span class="annottext">Map TxIn (TxOut era)
</span><a href="#local-6989586621679142174"><span class="hs-identifier hs-var">utxoMap</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-252"></span><span>    </span><span id="local-6989586621679142173"><span class="annot"><span class="annottext">values :: [Value]
</span><a href="#local-6989586621679142173"><span class="hs-identifier hs-var hs-var">values</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-253"></span><span>      </span><span class="hs-special">[</span><span>
</span><span id="line-254"></span><span>        </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679142172"><span class="hs-identifier hs-var">value'</span></a></span><span>
</span><span id="line-255"></span><span>      </span><span class="hs-glyph">|</span><span>
</span><span id="line-256"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="annottext">AddressInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxOutValue</span></span><span> </span><span class="annot"><span class="annottext">MultiAssetSupportedInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679142172"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679142172"><span class="hs-identifier hs-var">value'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxOutDatumHash era
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut era) -&gt; [(TxIn, TxOut era)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.assocs</span></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut era)
</span><a href="#local-6989586621679142174"><span class="hs-identifier hs-var">utxoMap</span></a></span><span>
</span><span id="line-257"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-keyword">in</span><span>
</span><span id="line-259"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Value] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621679142173"><span class="hs-identifier hs-var">values</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Value] -&gt; Value
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621679142173"><span class="hs-identifier hs-var">values</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="hs-comment">-- | Prepare a minting script.</span><span>
</span><span id="line-263"></span><span class="annot"><a href="Mantra.Transaction.html#makeMinting"><span class="hs-identifier hs-type">makeMinting</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>                               </span><span class="hs-comment">-- ^ The value to which minting will be added.</span><span>
</span><span id="line-264"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>                              </span><span class="hs-comment">-- ^ The asset name.</span><span>
</span><span id="line-265"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span>                             </span><span class="hs-comment">-- ^ The number of tokens to omit.</span><span>
</span><span id="line-266"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hash</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentKey</span></span><span>                     </span><span class="hs-comment">-- ^ Hash of the payment key.</span><span>
</span><span id="line-267"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span>                        </span><span class="hs-comment">-- ^ The last slot number for minting.</span><span>
</span><span id="line-268"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PolicyId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SimpleScript</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SimpleScriptV2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ The minting script, value minted, and total value.</span><span>
</span><span id="line-269"></span><span id="makeMinting"><span class="annot"><span class="annottext">makeMinting :: Value
-&gt; FilePath
-&gt; Integer
-&gt; Hash PaymentKey
-&gt; Maybe SlotNo
-&gt; ((PolicyId, SimpleScript SimpleScriptV2, Value), Value)
</span><a href="Mantra.Transaction.html#makeMinting"><span class="hs-identifier hs-var hs-var">makeMinting</span></a></span></span><span> </span><span id="local-6989586621679142170"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679142170"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span id="local-6989586621679142169"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679142169"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679142168"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679142168"><span class="hs-identifier hs-var">count</span></a></span></span><span> </span><span id="local-6989586621679142167"><span class="annot"><span class="annottext">Hash PaymentKey
</span><a href="#local-6989586621679142167"><span class="hs-identifier hs-var">verification</span></a></span></span><span> </span><span id="local-6989586621679142166"><span class="annot"><span class="annottext">Maybe SlotNo
</span><a href="#local-6989586621679142166"><span class="hs-identifier hs-var">before</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-270"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-271"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679142165"><span class="annot"><span class="annottext">SimpleScript SimpleScriptV2
</span><a href="#local-6989586621679142165"><span class="hs-identifier hs-var">script</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679142164"><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679142164"><span class="hs-identifier hs-var">scriptHash</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash PaymentKey
-&gt; Maybe SlotNo -&gt; (SimpleScript SimpleScriptV2, ScriptHash)
</span><a href="Mantra.Script.html#mintingScript"><span class="hs-identifier hs-var">mintingScript</span></a></span><span> </span><span class="annot"><span class="annottext">Hash PaymentKey
</span><a href="#local-6989586621679142167"><span class="hs-identifier hs-var">verification</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SlotNo
</span><a href="#local-6989586621679142166"><span class="hs-identifier hs-var">before</span></a></span><span>
</span><span id="line-272"></span><span>    </span><span id="local-6989586621679142163"><span class="annot"><span class="annottext">minting :: Value
</span><a href="#local-6989586621679142163"><span class="hs-identifier hs-var hs-var">minting</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(AssetId, Quantity)] -&gt; Value
</span><span class="hs-identifier hs-var">valueFromList</span></span><span>
</span><span id="line-273"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">(</span><span>
</span><span id="line-274"></span><span>        </span><span class="annot"><span class="annottext">PolicyId -&gt; AssetName -&gt; AssetId
</span><span class="hs-identifier hs-var">AssetId</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptHash -&gt; PolicyId
</span><span class="hs-identifier hs-var">PolicyId</span></span><span> </span><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679142164"><span class="hs-identifier hs-var">scriptHash</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; AssetName
</span><span class="hs-identifier hs-var">AssetName</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; AssetName) -&gt; ByteString -&gt; AssetName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; ByteString
</span><span class="hs-identifier hs-var">BS.pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679142169"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Quantity
</span><span class="hs-identifier hs-var">Quantity</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679142168"><span class="hs-identifier hs-var">count</span></a></span><span>
</span><span id="line-276"></span><span>      </span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-keyword">in</span><span>
</span><span id="line-278"></span><span>    </span><span class="hs-special">(</span><span>
</span><span id="line-279"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptHash -&gt; PolicyId
</span><span class="hs-identifier hs-var">PolicyId</span></span><span> </span><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679142164"><span class="hs-identifier hs-var">scriptHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SimpleScript SimpleScriptV2
</span><a href="#local-6989586621679142165"><span class="hs-identifier hs-var">script</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679142163"><span class="hs-identifier hs-var">minting</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679142170"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679142163"><span class="hs-identifier hs-var">minting</span></a></span><span>
</span><span id="line-281"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span class="hs-comment">-- | Prepare for minting from a JSON file specifying NFTs.</span><span>
</span><span id="line-285"></span><span id="local-6989586621679142161"><span class="annot"><a href="Mantra.Transaction.html#readMinting"><span class="hs-identifier hs-type">readMinting</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679142161"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-286"></span><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679142161"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-287"></span><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PolicyId</span></span><span>                               </span><span class="hs-comment">-- ^ The policy ID.</span><span>
</span><span id="line-288"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>                               </span><span class="hs-comment">-- ^ Path to the metadata file.</span><span>
</span><span id="line-289"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Mantra.Types.html#MantraM"><span class="hs-identifier hs-type">MantraM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679142161"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">A.Value</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxMetadata</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Action reading the metadata file and returning the JSON, metadata, and value for minting.</span></span><span>
</span><span id="line-290"></span><span id="readMinting"><span class="annot"><span class="annottext">readMinting :: PolicyId -&gt; FilePath -&gt; MantraM m (Value, TxMetadata, Value)
</span><a href="Mantra.Transaction.html#readMinting"><span class="hs-identifier hs-var hs-var">readMinting</span></a></span></span><span> </span><span id="local-6989586621679142160"><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621679142160"><span class="hs-identifier hs-var">policyId</span></a></span></span><span> </span><span id="local-6989586621679142159"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679142159"><span class="hs-identifier hs-var">filename</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-291"></span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-292"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">A.Object</span></span><span> </span><span id="local-6989586621679142157"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679142157"><span class="hs-identifier hs-var">json</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-293"></span><span>      </span><span class="annot"><span class="annottext">FilePath -&gt; IO (Maybe Value) -&gt; MantraM m Value
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
FilePath -&gt; IO (Maybe a) -&gt; MantraM m a
</span><a href="Mantra.Types.html#foistMantraMaybeIO"><span class="hs-identifier hs-var">foistMantraMaybeIO</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Could not decode metadata.&quot;</span></span><span>
</span><span id="line-294"></span><span>        </span><span class="annot"><span class="annottext">(IO (Maybe Value) -&gt; MantraM m Value)
-&gt; IO (Maybe Value) -&gt; MantraM m Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO (Maybe Value)
forall a. FromJSON a =&gt; FilePath -&gt; IO (Maybe a)
</span><span class="hs-identifier hs-var">A.decodeFileStrict</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679142159"><span class="hs-identifier hs-var">filename</span></a></span><span>
</span><span id="line-295"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-296"></span><span>      </span><span id="local-6989586621679142156"><span class="annot"><span class="annottext">json' :: Value
</span><a href="#local-6989586621679142156"><span class="hs-identifier hs-var hs-var">json'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-297"></span><span>        </span><span class="annot"><span class="annottext">Object -&gt; Value
</span><span class="hs-identifier hs-var">A.Object</span></span><span>
</span><span id="line-298"></span><span>        </span><span class="annot"><span class="annottext">(Object -&gt; Value) -&gt; (Object -&gt; Object) -&gt; Object -&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value -&gt; Object
forall k v. Hashable k =&gt; k -&gt; v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">H.singleton</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;721&quot;</span></span><span>
</span><span id="line-299"></span><span>        </span><span class="annot"><span class="annottext">(Value -&gt; Object) -&gt; (Object -&gt; Value) -&gt; Object -&gt; Object
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Value
</span><span class="hs-identifier hs-var">A.Object</span></span><span>
</span><span id="line-300"></span><span>        </span><span class="annot"><span class="annottext">(Object -&gt; Value) -&gt; Object -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value -&gt; Object
forall k v. Hashable k =&gt; k -&gt; v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">H.singleton</span></span><span>
</span><span id="line-301"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; Text)
-&gt; (ByteString -&gt; FilePath) -&gt; ByteString -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; FilePath
</span><span class="hs-identifier hs-var">BS.unpack</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Text) -&gt; ByteString -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; ByteString
forall a. SerialiseAsRawBytes a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">serialiseToRawBytesHex</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621679142160"><span class="hs-identifier hs-var">policyId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Object -&gt; Value
</span><span class="hs-identifier hs-var">A.Object</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679142157"><span class="hs-identifier hs-var">json</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>      </span><span id="local-6989586621679142155"><span class="annot"><span class="annottext">minting :: Value
</span><a href="#local-6989586621679142155"><span class="hs-identifier hs-var hs-var">minting</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-304"></span><span>        </span><span class="annot"><span class="annottext">[(AssetId, Quantity)] -&gt; Value
</span><span class="hs-identifier hs-var">valueFromList</span></span><span>
</span><span id="line-305"></span><span>          </span><span class="hs-special">[</span><span>
</span><span id="line-306"></span><span>            </span><span class="hs-special">(</span><span>
</span><span id="line-307"></span><span>              </span><span class="annot"><span class="annottext">PolicyId -&gt; AssetName -&gt; AssetId
</span><span class="hs-identifier hs-var">AssetId</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621679142160"><span class="hs-identifier hs-var">policyId</span></a></span><span> </span><span class="annot"><span class="annottext">(AssetName -&gt; AssetId)
-&gt; (FilePath -&gt; AssetName) -&gt; FilePath -&gt; AssetId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; AssetName
</span><span class="hs-identifier hs-var">AssetName</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; AssetName)
-&gt; (FilePath -&gt; ByteString) -&gt; FilePath -&gt; AssetName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; ByteString
</span><span class="hs-identifier hs-var">BS.pack</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; AssetId) -&gt; FilePath -&gt; AssetId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FilePath
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679142154"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-308"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Quantity
</span><span class="hs-identifier hs-var">Quantity</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span>
</span><span id="line-309"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>          </span><span class="hs-glyph">|</span><span>
</span><span id="line-311"></span><span>            </span><span id="local-6989586621679142154"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679142154"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Object -&gt; [Text]
forall k v. HashMap k v -&gt; [k]
</span><span class="hs-identifier hs-var">H.keys</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679142157"><span class="hs-identifier hs-var">json</span></a></span><span>
</span><span id="line-312"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-313"></span><span>    </span><span id="local-6989586621679142153"><span class="annot"><span class="annottext">TxMetadata
</span><a href="#local-6989586621679142153"><span class="hs-identifier hs-var">metadata</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-314"></span><span>      </span><span class="annot"><span class="annottext">Either TxMetadataJsonError TxMetadata -&gt; MantraM m TxMetadata
forall (m :: * -&gt; *) e a.
(Monad m, Show e) =&gt;
Either e a -&gt; MantraM m a
</span><a href="Mantra.Types.html#foistMantraEither"><span class="hs-identifier hs-var">foistMantraEither</span></a></span><span>
</span><span id="line-315"></span><span>        </span><span class="annot"><span class="annottext">(Either TxMetadataJsonError TxMetadata -&gt; MantraM m TxMetadata)
-&gt; Either TxMetadataJsonError TxMetadata -&gt; MantraM m TxMetadata
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TxMetadataJsonSchema
-&gt; Value -&gt; Either TxMetadataJsonError TxMetadata
</span><span class="hs-identifier hs-var">metadataFromJson</span></span><span> </span><span class="annot"><span class="annottext">TxMetadataJsonSchema
</span><span class="hs-identifier hs-var">TxMetadataJsonNoSchema</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679142156"><span class="hs-identifier hs-var">json'</span></a></span><span>
</span><span id="line-316"></span><span>    </span><span class="annot"><span class="annottext">(Value, TxMetadata, Value) -&gt; MantraM m (Value, TxMetadata, Value)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679142156"><span class="hs-identifier hs-var">json'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxMetadata
</span><a href="#local-6989586621679142153"><span class="hs-identifier hs-var">metadata</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679142155"><span class="hs-identifier hs-var">minting</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-317"></span></pre></body></html>